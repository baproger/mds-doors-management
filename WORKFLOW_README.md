# MDS Doors: Contract Workflow System

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ workflow –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞–º–∏ MDS Doors —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è: **–ú–µ–Ω–µ–¥–∂–µ—Ä ‚Üí –†–û–ü ‚Üí –ë—É—Ö–≥–∞–ª—Ç–µ—Ä**.

## –†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

### üë§ –ú–µ–Ω–µ–¥–∂–µ—Ä
- **–°–æ–∑–¥–∞–Ω–∏–µ**: –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ –¥–æ–≥–æ–≤–æ—Ä—ã
- **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –¢–æ–ª—å–∫–æ –≤ —Å—Ç–∞—Ç—É—Å–µ `draft` –∏–ª–∏ `rejected`
- **Workflow**: –ú–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–æ–≥–æ–≤–æ—Ä—ã –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –†–û–ü
- **–î–æ—Å—Ç—É–ø**: –¢–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–æ–≥–æ–≤–æ—Ä—ã

### üë®‚Äçüíº –†–û–ü (–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –æ—Ç–¥–µ–ª–∞ –ø—Ä–æ–¥–∞–∂)
- **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–æ–≥–æ–≤–æ—Ä—ã –≤ —Å—Ç–∞—Ç—É—Å–µ `pending_rop` –∏–ª–∏ `rejected`
- **Workflow**: –ú–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–æ–≥–æ–≤–æ—Ä—ã –±—É—Ö–≥–∞–ª—Ç–µ—Ä—É
- **–î–æ—Å—Ç—É–ø**: –í—Å–µ –¥–æ–≥–æ–≤–æ—Ä—ã —Å–≤–æ–µ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞

### üë©‚Äçüíº –ë—É—Ö–≥–∞–ª—Ç–µ—Ä
- **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ù–µ –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—è –¥–æ–≥–æ–≤–æ—Ä–∞
- **Workflow**: –ú–æ–∂–µ—Ç –æ–¥–æ–±—Ä—è—Ç—å, –æ—Ç–∫–ª–æ–Ω—è—Ç—å, –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å, –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É
- **–î–æ—Å—Ç—É–ø**: –í—Å–µ –¥–æ–≥–æ–≤–æ—Ä—ã –≤ —Å—Ç–∞—Ç—É—Å–µ `pending_accountant`

### üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
- **–ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø**: –ú–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –ª—é–±—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
- **Override**: –ú–æ–∂–µ—Ç —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –æ–¥–æ–±—Ä–µ–Ω–Ω—ã–µ –¥–æ–≥–æ–≤–æ—Ä—ã

## –°—Ç–∞—Ç—É—Å—ã –¥–æ–≥–æ–≤–æ—Ä–æ–≤

| –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ | –ö—Ç–æ –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å |
|--------|----------|-------------------------|
| `draft` | –ß–µ—Ä–Ω–æ–≤–∏–∫ | –ú–µ–Ω–µ–¥–∂–µ—Ä (—Å–æ–∑–¥–∞—Ç–µ–ª—å) |
| `pending_rop` | –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏ –†–û–ü | –†–û–ü |
| `pending_accountant` | –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏ –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∞ | –¢–æ–ª—å–∫–æ –±—É—Ö–≥–∞–ª—Ç–µ—Ä (–¥–µ–π—Å—Ç–≤–∏—è) |
| `approved` | –û–¥–æ–±—Ä–µ–Ω | –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω |
| `rejected` | –û—Ç–∫–ª–æ–Ω–µ–Ω | –†–û–ü |
| `on_hold` | –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω | –ë—É—Ö–≥–∞–ª—Ç–µ—Ä |

## Workflow –ø–µ—Ä–µ—Ö–æ–¥—ã

```mermaid
graph TD
    A[draft] --> B[pending_rop]
    B --> C[pending_accountant]
    C --> D[approved]
    C --> E[rejected]
    C --> F[on_hold]
    C --> G[pending_rop]
    E --> B
    F --> C
```

### –î–µ–π—Å—Ç–≤–∏—è –ø–æ —Ä–æ–ª—è–º:

**–ú–µ–Ω–µ–¥–∂–µ—Ä:**
- `draft` ‚Üí `pending_rop` (–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –†–û–ü)

**–†–û–ü:**
- `pending_rop` ‚Üí `pending_accountant` (–û—Ç–ø—Ä–∞–≤–∏—Ç—å –±—É—Ö–≥–∞–ª—Ç–µ—Ä—É)
- `rejected` ‚Üí `pending_accountant` (–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞)

**–ë—É—Ö–≥–∞–ª—Ç–µ—Ä:**
- `pending_accountant` ‚Üí `approved` (–û–¥–æ–±—Ä–∏—Ç—å)
- `pending_accountant` ‚Üí `rejected` (–û—Ç–∫–ª–æ–Ω–∏—Ç—å)
- `pending_accountant` ‚Üí `on_hold` (–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å)
- `pending_accountant` ‚Üí `pending_rop` (–í–µ—Ä–Ω—É—Ç—å –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É)

## –ê—É–¥–∏—Ç –∏ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

### –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ö–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª—è –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ `contract_changes`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∞–≤—Ç–æ—Ä–∞ –∏ –≤—Ä–µ–º–µ–Ω–∏

### –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–ª—è
–°–ª–µ–¥—É—é—â–∏–µ –ø–æ–ª—è —Ç—Ä–µ–±—É—é—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –æ–¥–æ–±—Ä–µ–Ω–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏:
- `order_total` (–û–±—â–∞—è —Å—É–º–º–∞)
- `order_deposit` (–î–µ–ø–æ–∑–∏—Ç)
- `order_remainder` (–û—Å—Ç–∞—Ç–æ–∫)
- `order_due` (–ö –æ–ø–ª–∞—Ç–µ)
- `payment` (–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã)

## API Endpoints

### Workflow –¥–µ–π—Å—Ç–≤–∏—è
```
POST /admin/contracts/{contract}/submit-to-rop
POST /admin/contracts/{contract}/submit-to-accountant
POST /admin/contracts/{contract}/approve
POST /admin/contracts/{contract}/reject
POST /admin/contracts/{contract}/hold
POST /admin/contracts/{contract}/return
GET  /admin/contracts/{contract}/history
```

### –†–æ–ª–µ–≤—ã–µ –ø—Ä–µ—Ñ–∏–∫—Å—ã
- `/admin/` - –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- `/manager/` - –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
- `/rop/` - –¥–ª—è –†–û–ü
- `/accountant/` - –¥–ª—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä–æ–≤

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã UI

### –°—Ç–∞—Ç—É—Å –¥–æ–≥–æ–≤–æ—Ä–∞
```blade
<x-contract-status :contract="$contract" />
```

### –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
```blade
<x-workflow-actions :contract="$contract" />
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- `contract_changes` - –∞—É–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ–ª–µ–π
- `approvals` - –∏—Å—Ç–æ—Ä–∏—è –æ–¥–æ–±—Ä–µ–Ω–∏–π

### –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ contracts
- `status` - —Å—Ç–∞—Ç—É—Å –¥–æ–≥–æ–≤–æ—Ä–∞
- `version` - –≤–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞
- `current_reviewer_id` - ID —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ—Ü–µ–Ω–∑–µ–Ω—Ç–∞

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã
```
–ú–µ–Ω–µ–¥–∂–µ—Ä: manager@test.com / password
–†–û–ü: rop@test.com / password
–ë—É—Ö–≥–∞–ª—Ç–µ—Ä: accountant@test.com / password
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
php artisan db:seed --class=WorkflowTestSeeder
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –í–∞–ª–∏–¥–∞—Ü–∏—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å—Ç–∞—Ç—É—Å–æ–≤
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è/–ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∏

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `storage/logs/laravel.log`
- –ê—É–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

## –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è):
- Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞
- In-app —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ —à–∞–±–ª–æ–Ω—ã

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
- –ü–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤
1. –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É –≤ –º–æ–¥–µ–ª—å `Contract`
2. –û–±–Ω–æ–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é enum
3. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –≤ `ContractStateService`
4. –û–±–Ω–æ–≤–∏—Ç—å UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
1. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –≤ `ContractStateService`
2. –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä action
3. –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç
4. –û–±–Ω–æ–≤–∏—Ç—å UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `storage/logs/laravel.log`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –£–±–µ–¥–∏—Ç—å—Å—è –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Å—Ç–∞—Ç—É—Å–∞ –¥–æ–≥–æ–≤–æ—Ä–∞
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤—è–∑–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
